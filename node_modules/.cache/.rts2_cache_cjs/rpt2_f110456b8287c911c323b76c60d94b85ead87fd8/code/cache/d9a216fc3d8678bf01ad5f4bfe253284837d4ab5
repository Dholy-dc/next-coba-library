{"code":"import * as React from 'react';\r\nimport { Badge, Button, notification } from 'antd';\r\nimport { Content } from './content';\r\nimport { BASE_PATH_NOTIF, socketNotif } from './api';\r\nimport { createColllection, getDataPegawaiByNip, getMessageRecieve } from './fetchaction';\r\nimport { BellOutlined } from '@ant-design/icons';\r\nexport const MessageComponent = ({ style, nip, nama, id_user, kode_group, token_lama, token_baru, url_foto_user }) => {\r\n    const [open, setOpen] = React.useState(false);\r\n    const [dataMessageRecieve, setDataMessageRecieve] = React.useState([]);\r\n    const [dataMessageSender, setDataMessageSender] = React.useState([]);\r\n    const [focusMessage, setFocusMessage] = React.useState('');\r\n    const [dataPegawai, setDataPegawai] = React.useState([]);\r\n    const [idMessageRead, setIdMessageRead] = React.useState(null);\r\n    const [countMessage, setCountMessage] = React.useState(0);\r\n    const [loadingRightContent, setLoadingRightContent] = React.useState(false);\r\n    const [loadingLeftContent, setLoadingLeftContent] = React.useState(false);\r\n    const dataauthusman = {\r\n        id_user: id_user,\r\n        kode_group: kode_group,\r\n        token_lama: token_lama,\r\n        token_baru: token_baru\r\n    };\r\n    const datauser = {\r\n        nip: nip,\r\n        nama: nama,\r\n        url_foto: url_foto_user\r\n    };\r\n    React.useEffect(() => {\r\n        socketNotif.emit('join_room_testing', {\r\n            roomId: nip\r\n        });\r\n        socketNotif.connect();\r\n    }, []);\r\n    React.useEffect(() => {\r\n        const counts = dataMessageRecieve?.filter((a) => a.status_read === false);\r\n        setCountMessage(counts?.length);\r\n    }, [dataMessageRecieve]);\r\n    React.useEffect(() => {\r\n        socketNotif.on('message', (data) => {\r\n            if (data.response === 'receive_message') {\r\n                notification.info({ message: 'Anda Mempunyai Pesan Baru' });\r\n                setDataMessageRecieve((a) => [data?.dataMessage, ...a]);\r\n                getDataPegawaiByNip(dataauthusman, [\r\n                    {\r\n                        nip: data?.dataMessage?.from\r\n                    }\r\n                ]).then((res) => {\r\n                    if (res?.data?.status === 'Success') {\r\n                        setDataPegawai((a) => [...a, ...res?.data?.data]);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n        return () => {\r\n            socketNotif.close();\r\n        };\r\n    }, [socketNotif]);\r\n    React.useEffect(() => {\r\n        socketNotif.on('message', (data) => {\r\n            if (data.response === 'status_read') {\r\n                setIdMessageRead(data.dataMessage._id);\r\n            }\r\n        });\r\n        return () => {\r\n            socketNotif.close();\r\n        };\r\n    }, [socketNotif]);\r\n    React.useEffect(() => {\r\n        if (idMessageRead !== null) {\r\n            updateRead();\r\n        }\r\n    }, [idMessageRead]);\r\n    const updateRead = () => {\r\n        const p = [...dataMessageSender];\r\n        const l = dataMessageSender.some((m) => m._id === idMessageRead);\r\n        if (l === true) {\r\n            const k = dataMessageSender.findIndex((a) => a._id === idMessageRead);\r\n            p[k].status_read = true;\r\n            setDataMessageSender(p);\r\n            setIdMessageRead(null);\r\n        }\r\n    };\r\n    const funtionGetDataPegawai = (val) => {\r\n        const tampungNip = [];\r\n        const tampungNip2 = [];\r\n        val?.forEach((a) => {\r\n            tampungNip.push(a.from);\r\n            tampungNip.push(a.to);\r\n        });\r\n        if (tampungNip.length > 0) {\r\n            const u = new Set(tampungNip);\r\n            u.forEach((a) => {\r\n                tampungNip2.push({\r\n                    nip: a\r\n                });\r\n            });\r\n            getDataPegawaiByNip(dataauthusman, tampungNip2).then((res) => {\r\n                console.log('asasd', val, res);\r\n                if (res?.data?.status === 'Success') {\r\n                    setDataPegawai((a) => [...a, ...res?.data?.data]);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    React.useEffect(() => {\r\n        setLoadingLeftContent(true);\r\n        createColllection(dataauthusman, nip).then((response) => {\r\n            if (response?.data?.status === 'done') {\r\n            }\r\n            else {\r\n                let val = response?.data?.children;\r\n                setDataMessageRecieve(val);\r\n            }\r\n        });\r\n        getMessageRecieve(BASE_PATH_NOTIF.get_by_recieve + nip + '/0/50', dataauthusman)\r\n            .then((data) => {\r\n            setLoadingLeftContent(false);\r\n            if (data?.data?.status === 'success') {\r\n                let val = data?.data?.data;\r\n                setDataMessageRecieve(val);\r\n                if (data?.data?.data?.length > 0) {\r\n                    funtionGetDataPegawai(data?.data?.data);\r\n                }\r\n            }\r\n            else {\r\n                setDataMessageRecieve([]);\r\n            }\r\n        })\r\n            .catch((err) => {\r\n            setLoadingLeftContent(false);\r\n            setDataMessageRecieve([]);\r\n            console.log(err);\r\n        });\r\n        getMessageRecieve(BASE_PATH_NOTIF.get_by_from + nip + '/0/50', dataauthusman)\r\n            .then((data) => {\r\n            setLoadingLeftContent(false);\r\n            if (data?.data?.status === 'success') {\r\n                let val = data?.data?.data;\r\n                setDataMessageSender(val);\r\n                if (data?.data?.data?.length > 0) {\r\n                    funtionGetDataPegawai(data?.data?.data);\r\n                }\r\n            }\r\n            else {\r\n                setDataMessageSender([]);\r\n            }\r\n        })\r\n            .catch((err) => {\r\n            setLoadingLeftContent(false);\r\n            setDataMessageSender([]);\r\n            console.log(err);\r\n        });\r\n    }, []);\r\n    return (React.createElement(\"div\", { style: style },\r\n        React.createElement(Badge, { count: countMessage, showZero: false, size: 'default', style: {} },\r\n            React.createElement(Button, { icon: React.createElement(BellOutlined, { style: { fontSize: 20 } }), onClick: () => {\r\n                    setOpen(true);\r\n                } })),\r\n        React.createElement(Content, { open: open, setOpen: setOpen, dataMessageRecieve: dataMessageRecieve, dataMessageSender: dataMessageSender, focusMessage: focusMessage, setFocusMessage: setFocusMessage, datauser: datauser, dataPegawai: dataPegawai, dataauthusman: dataauthusman, name: nama, nip: nip, setDataMessageReceive: setDataMessageRecieve, setDataMessageSender: setDataMessageSender, funtionGetDataPegawai: funtionGetDataPegawai, loadingRightContent: loadingRightContent, setLoadingRightContent: setLoadingRightContent, loadingLeftContent: loadingLeftContent, setLoadingLeftContent: setLoadingLeftContent })));\r\n};\r\n//# sourceMappingURL=index.js.map","references":["/Users/macbookm2/Documents/project/package/my-component-library/node_modules/@types/react/index.d.ts","/Users/macbookm2/Documents/project/package/my-component-library/node_modules/antd/es/index.d.ts","/Users/macbookm2/Documents/project/package/my-component-library/src/content.tsx","/Users/macbookm2/Documents/project/package/my-component-library/src/api.tsx","/Users/macbookm2/Documents/project/package/my-component-library/src/fetchaction.tsx","/Users/macbookm2/Documents/project/package/my-component-library/node_modules/@ant-design/icons/lib/index.d.ts"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/index.tsx\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/macbookm2/Documents/project/package/my-component-library/index.d.ts","writeByteOrderMark":false,"text":"import * as React from 'react';\r\nexport declare const MessageComponent: ({ style, nip, nama, id_user, kode_group, token_lama, token_baru, url_foto_user }: {\r\n    style: React.CSSProperties;\r\n    nip: string;\r\n    nama: string;\r\n    id_user: string | null;\r\n    kode_group: string | null;\r\n    token_lama: string | null;\r\n    token_baru: string | null;\r\n    url_foto_user: string | null;\r\n}) => React.JSX.Element;\r\n"}}
